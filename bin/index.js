"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const typedArrayToNodeBuffer = require("typedarray-to-buffer");
const isNode = require('is-node');
exports.blobToNodeBuffer = require('blob-to-buffer');
exports.isNodeBuffer = require('is-buffer');
exports.nodeBufferToArraybuffer = require('to-arraybuffer');
exports.NodeBuffer = isNode ? Buffer : require('buffer/').Buffer;
/**
 * 序列化标记，标记一个Buffer是object2buffer序列化的结果
 */
exports._serializeMark = exports.NodeBuffer.from('+o2b`');
/**
 * 对数据进行序列化。
 * 二进制数据格式： 元素类型 -> [元素长度] -> 元素内容
 */
function serialize(data) {
    const bufferItems = [exports._serializeMark];
    for (let item of data)
        switch (Object.prototype.toString.call(item)) {
            case '[object Number]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = exports.NodeBuffer.alloc(8);
                type.writeUInt8(0 /* number */, 0);
                content.writeDoubleBE(item, 0);
                bufferItems.push(type, content);
                break;
            }
            case '[object String]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = exports.NodeBuffer.from(item);
                const contentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(1 /* string */, 0);
                contentLength.writeDoubleBE(content.length, 0);
                bufferItems.push(type, contentLength, content);
                break;
            }
            case '[object Boolean]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = exports.NodeBuffer.alloc(1);
                type.writeUInt8(2 /* boolean */, 0);
                content.writeUInt8(item ? 1 : 0, 0);
                bufferItems.push(type, content);
                break;
            }
            case '[object Null]': {
                const type = exports.NodeBuffer.alloc(1);
                type.writeUInt8(3 /* null */, 0);
                bufferItems.push(type);
                break;
            }
            case '[object Undefined]': {
                const type = exports.NodeBuffer.alloc(1);
                type.writeUInt8(4 /* undefined */, 0);
                bufferItems.push(type);
                break;
            }
            case '[object Date]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = exports.NodeBuffer.alloc(8);
                type.writeUInt8(5 /* Date */, 0);
                content.writeDoubleBE(item.getTime(), 0);
                bufferItems.push(type, content);
                break;
            }
            case '[object RegExp]': {
                const type = exports.NodeBuffer.alloc(1);
                const source = item.source; //正则匹配模式 
                const flags = item.flags;
                const sourceContent = exports.NodeBuffer.from(source);
                const sourceContentLength = exports.NodeBuffer.alloc(8);
                const flagsContent = exports.NodeBuffer.from(flags);
                const flagsContentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(6 /* RegExp */, 0);
                sourceContentLength.writeDoubleBE(sourceContent.length, 0);
                flagsContentLength.writeDoubleBE(flagsContent.length, 0);
                bufferItems.push(type, sourceContentLength, sourceContent, flagsContentLength, flagsContent);
                break;
            }
            case '[object Array]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = serialize(item);
                const contentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(7 /* Array */, 0);
                contentLength.writeDoubleBE(content.length, 0);
                bufferItems.push(type, contentLength, content);
                break;
            }
            case '[object Object]': {
                const keys = Object.keys(item);
                const values = keys.map(key => item[key]);
                const type = exports.NodeBuffer.alloc(1);
                const content = serialize([keys, values]);
                const contentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(8 /* Object */, 0);
                contentLength.writeDoubleBE(content.length, 0);
                bufferItems.push(type, contentLength, content);
                break;
            }
            case exports.isNodeBuffer(item): {
                const type = exports.NodeBuffer.alloc(1);
                const content = item;
                const contentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(9 /* Buffer */, 0);
                contentLength.writeDoubleBE(content.length, 0);
                bufferItems.push(type, contentLength, content);
                break;
            }
            case '[object DataView]': {
                item = item.buffer;
            }
            case '[object ArrayBuffer]':
            case '[object Int8Array]':
            case '[object Int16Array]':
            case '[object Int32Array]':
            case '[object Uint8Array]':
            case '[object Uint8ClampedArray]':
            case '[object Uint16Array]':
            case '[object Uint32Array]':
            case '[object Float32Array]':
            case '[object Float64Array]': {
                const type = exports.NodeBuffer.alloc(1);
                const content = typedArrayToNodeBuffer(item);
                const contentLength = exports.NodeBuffer.alloc(8);
                type.writeUInt8(9 /* Buffer */, 0);
                contentLength.writeDoubleBE(content.length, 0);
                bufferItems.push(type, contentLength, content);
                break;
            }
            default: {
                const type = exports.NodeBuffer.alloc(1);
                type.writeUInt8(10 /* unknow */, 0);
                bufferItems.push(type);
                break;
            }
        }
    return exports.NodeBuffer.concat(bufferItems);
}
exports.serialize = serialize;
/**
 * 对数据进行反序列化。
 * 注意：传入的Buffer需是使用是object2buffer序列化产生的
 */
function deserialize(data) {
    let previous = 0;
    if (!data.slice(0, previous += exports._serializeMark.length).equals(exports._serializeMark))
        throw new Error('传入的Buffer并不是由object2buffer序列化产生的，无法进行反序列化');
    const result = [];
    while (previous < data.length) {
        const type = data.readUInt8(previous++);
        switch (type) {
            case 0 /* number */: {
                result.push(data.readDoubleBE(previous));
                previous += 8;
                break;
            }
            case 1 /* string */: {
                const length = data.readDoubleBE(previous);
                previous += 8;
                const content = data.slice(previous, previous += length);
                result.push(content.toString());
                break;
            }
            case 2 /* boolean */: {
                const content = data.readUInt8(previous++);
                result.push(content === 1);
                break;
            }
            case 3 /* null */: {
                result.push(null);
                break;
            }
            case 4 /* undefined */: {
                result.push(undefined);
                break;
            }
            case 5 /* Date */: {
                const time = data.readDoubleBE(previous);
                previous += 8;
                result.push(new Date(time));
                break;
            }
            case 6 /* RegExp */: {
                const sourceContentLength = data.readDoubleBE(previous);
                previous += 8;
                const sourceContent = data.slice(previous, previous += sourceContentLength);
                const flagsContentLength = data.readDoubleBE(previous);
                previous += 8;
                const flagsContent = data.slice(previous, previous += flagsContentLength);
                result.push(new RegExp(sourceContent.toString(), flagsContent.toString()));
                break;
            }
            case 7 /* Array */: {
                const length = data.readDoubleBE(previous);
                previous += 8;
                const content = data.slice(previous, previous += length);
                result.push(deserialize(content));
                break;
            }
            case 8 /* Object */: {
                const length = data.readDoubleBE(previous);
                previous += 8;
                const content = data.slice(previous, previous += length);
                const [keys, values] = deserialize(content);
                const obj = {};
                for (var i = 0; i < keys.length; i++) {
                    obj[keys[i]] = values[i];
                }
                result.push(obj);
                break;
            }
            case 9 /* Buffer */: {
                const length = data.readDoubleBE(previous);
                previous += 8;
                result.push(data.slice(previous, previous += length));
                break;
            }
            case 10 /* unknow */: {
                result.push(undefined);
                break;
            }
            default: {
                throw new Error('要被反序列化的数据类型不存在，类型为: ' + type);
            }
        }
    }
    return result;
}
exports.deserialize = deserialize;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsTUFBTSxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUMvRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFFckIsUUFBQSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUM3QyxRQUFBLFlBQVksR0FBOEIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQy9ELFFBQUEsdUJBQXVCLEdBQWtDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ25GLFFBQUEsVUFBVSxHQUFrQixNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUVyRjs7R0FFRztBQUNVLFFBQUEsY0FBYyxHQUFHLGtCQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRXZEOzs7R0FHRztBQUNILG1CQUEwQixJQUFnQjtJQUN0QyxNQUFNLFdBQVcsR0FBYSxDQUFDLHNCQUFjLENBQUMsQ0FBQztJQUUvQyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBUyxJQUFJLENBQUM7UUFBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZFLEtBQUssaUJBQWlCLEVBQUUsQ0FBQztnQkFDckIsTUFBTSxJQUFJLEdBQUcsa0JBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLE1BQU0sT0FBTyxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVwQyxJQUFJLENBQUMsVUFBVSxpQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUUvQixXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDaEMsS0FBSyxDQUFDO1lBQ1YsQ0FBQztZQUNELEtBQUssaUJBQWlCLEVBQUUsQ0FBQztnQkFDckIsTUFBTSxJQUFJLEdBQUcsa0JBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLE1BQU0sT0FBTyxHQUFHLGtCQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0QyxNQUFNLGFBQWEsR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFMUMsSUFBSSxDQUFDLFVBQVUsaUJBQWtCLENBQUMsQ0FBQyxDQUFDO2dCQUNwQyxhQUFhLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRS9DLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDL0MsS0FBSyxDQUFDO1lBQ1YsQ0FBQztZQUNELEtBQUssa0JBQWtCLEVBQUUsQ0FBQztnQkFDdEIsTUFBTSxJQUFJLEdBQUcsa0JBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLE1BQU0sT0FBTyxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVwQyxJQUFJLENBQUMsVUFBVSxrQkFBbUIsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFcEMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ2hDLEtBQUssQ0FBQztZQUNWLENBQUM7WUFDRCxLQUFLLGVBQWUsRUFBRSxDQUFDO2dCQUNuQixNQUFNLElBQUksR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsSUFBSSxDQUFDLFVBQVUsZUFBZ0IsQ0FBQyxDQUFDLENBQUM7Z0JBRWxDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZCLEtBQUssQ0FBQztZQUNWLENBQUM7WUFDRCxLQUFLLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3hCLE1BQU0sSUFBSSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLENBQUMsVUFBVSxvQkFBcUIsQ0FBQyxDQUFDLENBQUM7Z0JBRXZDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZCLEtBQUssQ0FBQztZQUNWLENBQUM7WUFDRCxLQUFLLGVBQWUsRUFBRSxDQUFDO2dCQUNuQixNQUFNLElBQUksR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsa0JBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXBDLElBQUksQ0FBQyxVQUFVLGVBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFekMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ2hDLEtBQUssQ0FBQztZQUNWLENBQUM7WUFDRCxLQUFLLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3JCLE1BQU0sSUFBSSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUztnQkFDckMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFFekIsTUFBTSxhQUFhLEdBQUcsa0JBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sbUJBQW1CLEdBQUcsa0JBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sWUFBWSxHQUFHLGtCQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM1QyxNQUFNLGtCQUFrQixHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUUvQyxJQUFJLENBQUMsVUFBVSxpQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUMzRCxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFekQsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUM3RixLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsS0FBSyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUNwQixNQUFNLElBQUksR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNoQyxNQUFNLGFBQWEsR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFMUMsSUFBSSxDQUFDLFVBQVUsZ0JBQWlCLENBQUMsQ0FBQyxDQUFDO2dCQUNuQyxhQUFhLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRS9DLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDL0MsS0FBSyxDQUFDO1lBQ1YsQ0FBQztZQUNELEtBQUssaUJBQWlCLEVBQUUsQ0FBQztnQkFDckIsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDL0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUUxQyxNQUFNLElBQUksR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLE1BQU0sYUFBYSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUUxQyxJQUFJLENBQUMsVUFBVSxpQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFL0MsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUMvQyxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsS0FBSyxvQkFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQ3RCLE1BQU0sSUFBSSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUM7Z0JBQ3JCLE1BQU0sYUFBYSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUUxQyxJQUFJLENBQUMsVUFBVSxpQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFL0MsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUMvQyxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsS0FBSyxtQkFBbUIsRUFBRSxDQUFDO2dCQUN2QixJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUN2QixDQUFDO1lBQ0QsS0FBSyxzQkFBc0IsQ0FBQztZQUM1QixLQUFLLG9CQUFvQixDQUFDO1lBQzFCLEtBQUsscUJBQXFCLENBQUM7WUFDM0IsS0FBSyxxQkFBcUIsQ0FBQztZQUMzQixLQUFLLHFCQUFxQixDQUFDO1lBQzNCLEtBQUssNEJBQTRCLENBQUM7WUFDbEMsS0FBSyxzQkFBc0IsQ0FBQztZQUM1QixLQUFLLHNCQUFzQixDQUFDO1lBQzVCLEtBQUssdUJBQXVCLENBQUM7WUFDN0IsS0FBSyx1QkFBdUIsRUFBRSxDQUFDO2dCQUMzQixNQUFNLElBQUksR0FBRyxrQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzdDLE1BQU0sYUFBYSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUUxQyxJQUFJLENBQUMsVUFBVSxpQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFL0MsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUMvQyxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsU0FBUyxDQUFDO2dCQUNOLE1BQU0sSUFBSSxHQUFHLGtCQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLENBQUMsVUFBVSxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBRXBDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZCLEtBQUssQ0FBQztZQUNWLENBQUM7UUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLGtCQUFVLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFsSkQsOEJBa0pDO0FBRUQ7OztHQUdHO0FBQ0gscUJBQTRCLElBQVk7SUFDcEMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBRWpCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsUUFBUSxJQUFJLHNCQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLHNCQUFjLENBQUMsQ0FBQztRQUN6RSxNQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7SUFFakUsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBRWxCLE9BQU8sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM1QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFFeEMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNYLHFCQUFzQixDQUFDO2dCQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDekMsUUFBUSxJQUFJLENBQUMsQ0FBQztnQkFDZCxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QscUJBQXNCLENBQUM7Z0JBQ25CLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzNDLFFBQVEsSUFBSSxDQUFDLENBQUM7Z0JBRWQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxJQUFJLE1BQU0sQ0FBQyxDQUFDO2dCQUN6RCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO2dCQUNoQyxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0Qsc0JBQXVCLENBQUM7Z0JBQ3BCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLEtBQUssQ0FBQztZQUNWLENBQUM7WUFDRCxtQkFBb0IsQ0FBQztnQkFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbEIsS0FBSyxDQUFDO1lBQ1YsQ0FBQztZQUNELHdCQUF5QixDQUFDO2dCQUN0QixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUN2QixLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsbUJBQW9CLENBQUM7Z0JBQ2pCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3pDLFFBQVEsSUFBSSxDQUFDLENBQUM7Z0JBRWQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QscUJBQXNCLENBQUM7Z0JBQ25CLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEQsUUFBUSxJQUFJLENBQUMsQ0FBQztnQkFDZCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxRQUFRLElBQUksbUJBQW1CLENBQUMsQ0FBQztnQkFDNUUsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN2RCxRQUFRLElBQUksQ0FBQyxDQUFDO2dCQUNkLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLFFBQVEsSUFBSSxrQkFBa0IsQ0FBQyxDQUFDO2dCQUUxRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsRUFBRSxZQUFZLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUMzRSxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0Qsb0JBQXFCLENBQUM7Z0JBQ2xCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzNDLFFBQVEsSUFBSSxDQUFDLENBQUM7Z0JBRWQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxJQUFJLE1BQU0sQ0FBQyxDQUFDO2dCQUN6RCxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QscUJBQXNCLENBQUM7Z0JBQ25CLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzNDLFFBQVEsSUFBSSxDQUFDLENBQUM7Z0JBRWQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxJQUFJLE1BQU0sQ0FBQyxDQUFDO2dCQUN6RCxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQVEsQ0FBQztnQkFFbkQsTUFBTSxHQUFHLEdBQVEsRUFBRSxDQUFDO2dCQUNwQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDbkMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsQ0FBQztnQkFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNqQixLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QscUJBQXNCLENBQUM7Z0JBQ25CLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzNDLFFBQVEsSUFBSSxDQUFDLENBQUM7Z0JBRWQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxRQUFRLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDdEQsS0FBSyxDQUFDO1lBQ1YsQ0FBQztZQUNELHNCQUFzQixDQUFDO2dCQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUN2QixLQUFLLENBQUM7WUFDVixDQUFDO1lBQ0QsU0FBUyxDQUFDO2dCQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDbkQsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNsQixDQUFDO0FBakdELGtDQWlHQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRhdGFUeXBlLCBEYXRhVHlwZSB9IGZyb20gJy4vRGF0YVR5cGUnO1xyXG5jb25zdCB0eXBlZEFycmF5VG9Ob2RlQnVmZmVyID0gcmVxdWlyZShcInR5cGVkYXJyYXktdG8tYnVmZmVyXCIpO1xyXG5jb25zdCBpc05vZGUgPSByZXF1aXJlKCdpcy1ub2RlJyk7XHJcblxyXG5leHBvcnQgY29uc3QgYmxvYlRvTm9kZUJ1ZmZlciA9IHJlcXVpcmUoJ2Jsb2ItdG8tYnVmZmVyJyk7XHJcbmV4cG9ydCBjb25zdCBpc05vZGVCdWZmZXI6IChkYXRhOiBCdWZmZXIpID0+IGJvb2xlYW4gPSByZXF1aXJlKCdpcy1idWZmZXInKTtcclxuZXhwb3J0IGNvbnN0IG5vZGVCdWZmZXJUb0FycmF5YnVmZmVyOiAoZGF0YTogQnVmZmVyKSA9PiBBcnJheUJ1ZmZlciA9IHJlcXVpcmUoJ3RvLWFycmF5YnVmZmVyJyk7XHJcbmV4cG9ydCBjb25zdCBOb2RlQnVmZmVyOiB0eXBlb2YgQnVmZmVyID0gaXNOb2RlID8gQnVmZmVyIDogcmVxdWlyZSgnYnVmZmVyLycpLkJ1ZmZlcjtcclxuXHJcbi8qKlxyXG4gKiDluo/liJfljJbmoIforrDvvIzmoIforrDkuIDkuKpCdWZmZXLmmK9vYmplY3QyYnVmZmVy5bqP5YiX5YyW55qE57uT5p6cXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgX3NlcmlhbGl6ZU1hcmsgPSBOb2RlQnVmZmVyLmZyb20oJytvMmJgJyk7XHJcblxyXG4vKipcclxuICog5a+55pWw5o2u6L+b6KGM5bqP5YiX5YyW44CCXHJcbiAqIOS6jOi/m+WItuaVsOaNruagvOW8j++8miDlhYPntKDnsbvlnosgLT4gW+WFg+e0oOmVv+W6pl0gLT4g5YWD57Sg5YaF5a65ICAgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplKGRhdGE6IGRhdGFUeXBlW10pOiBCdWZmZXIge1xyXG4gICAgY29uc3QgYnVmZmVySXRlbXM6IEJ1ZmZlcltdID0gW19zZXJpYWxpemVNYXJrXTtcclxuXHJcbiAgICBmb3IgKGxldCBpdGVtIG9mIDxhbnk+ZGF0YSkgc3dpdGNoIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlbSkpIHtcclxuICAgICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBOb2RlQnVmZmVyLmFsbG9jKDEpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gTm9kZUJ1ZmZlci5hbGxvYyg4KTtcclxuXHJcbiAgICAgICAgICAgIHR5cGUud3JpdGVVSW50OChEYXRhVHlwZS5udW1iZXIsIDApO1xyXG4gICAgICAgICAgICBjb250ZW50LndyaXRlRG91YmxlQkUoaXRlbSwgMCk7XHJcblxyXG4gICAgICAgICAgICBidWZmZXJJdGVtcy5wdXNoKHR5cGUsIGNvbnRlbnQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBTdHJpbmddJzoge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gTm9kZUJ1ZmZlci5hbGxvYygxKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IE5vZGVCdWZmZXIuZnJvbShpdGVtKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuc3RyaW5nLCAwKTtcclxuICAgICAgICAgICAgY29udGVudExlbmd0aC53cml0ZURvdWJsZUJFKGNvbnRlbnQubGVuZ3RoLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGJ1ZmZlckl0ZW1zLnB1c2godHlwZSwgY29udGVudExlbmd0aCwgY29udGVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlICdbb2JqZWN0IEJvb2xlYW5dJzoge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gTm9kZUJ1ZmZlci5hbGxvYygxKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IE5vZGVCdWZmZXIuYWxsb2MoMSk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuYm9vbGVhbiwgMCk7XHJcbiAgICAgICAgICAgIGNvbnRlbnQud3JpdGVVSW50OChpdGVtID8gMSA6IDAsIDApO1xyXG5cclxuICAgICAgICAgICAgYnVmZmVySXRlbXMucHVzaCh0eXBlLCBjb250ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgTnVsbF0nOiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBOb2RlQnVmZmVyLmFsbG9jKDEpO1xyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUubnVsbCwgMCk7XHJcblxyXG4gICAgICAgICAgICBidWZmZXJJdGVtcy5wdXNoKHR5cGUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBVbmRlZmluZWRdJzoge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gTm9kZUJ1ZmZlci5hbGxvYygxKTtcclxuICAgICAgICAgICAgdHlwZS53cml0ZVVJbnQ4KERhdGFUeXBlLnVuZGVmaW5lZCwgMCk7XHJcblxyXG4gICAgICAgICAgICBidWZmZXJJdGVtcy5wdXNoKHR5cGUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6IHtcclxuICAgICAgICAgICAgY29uc3QgdHlwZSA9IE5vZGVCdWZmZXIuYWxsb2MoMSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBOb2RlQnVmZmVyLmFsbG9jKDgpO1xyXG5cclxuICAgICAgICAgICAgdHlwZS53cml0ZVVJbnQ4KERhdGFUeXBlLkRhdGUsIDApO1xyXG4gICAgICAgICAgICBjb250ZW50LndyaXRlRG91YmxlQkUoaXRlbS5nZXRUaW1lKCksIDApO1xyXG5cclxuICAgICAgICAgICAgYnVmZmVySXRlbXMucHVzaCh0eXBlLCBjb250ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgUmVnRXhwXSc6IHtcclxuICAgICAgICAgICAgY29uc3QgdHlwZSA9IE5vZGVCdWZmZXIuYWxsb2MoMSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBpdGVtLnNvdXJjZTsgLy/mraPliJnljLnphY3mqKHlvI8gXHJcbiAgICAgICAgICAgIGNvbnN0IGZsYWdzID0gaXRlbS5mbGFncztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUNvbnRlbnQgPSBOb2RlQnVmZmVyLmZyb20oc291cmNlKTtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlQ29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsYWdzQ29udGVudCA9IE5vZGVCdWZmZXIuZnJvbShmbGFncyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsYWdzQ29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuUmVnRXhwLCAwKTtcclxuICAgICAgICAgICAgc291cmNlQ29udGVudExlbmd0aC53cml0ZURvdWJsZUJFKHNvdXJjZUNvbnRlbnQubGVuZ3RoLCAwKTtcclxuICAgICAgICAgICAgZmxhZ3NDb250ZW50TGVuZ3RoLndyaXRlRG91YmxlQkUoZmxhZ3NDb250ZW50Lmxlbmd0aCwgMCk7XHJcblxyXG4gICAgICAgICAgICBidWZmZXJJdGVtcy5wdXNoKHR5cGUsIHNvdXJjZUNvbnRlbnRMZW5ndGgsIHNvdXJjZUNvbnRlbnQsIGZsYWdzQ29udGVudExlbmd0aCwgZmxhZ3NDb250ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgQXJyYXldJzoge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gTm9kZUJ1ZmZlci5hbGxvYygxKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IHNlcmlhbGl6ZShpdGVtKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuQXJyYXksIDApO1xyXG4gICAgICAgICAgICBjb250ZW50TGVuZ3RoLndyaXRlRG91YmxlQkUoY29udGVudC5sZW5ndGgsIDApO1xyXG5cclxuICAgICAgICAgICAgYnVmZmVySXRlbXMucHVzaCh0eXBlLCBjb250ZW50TGVuZ3RoLCBjb250ZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgT2JqZWN0XSc6IHtcclxuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGl0ZW0pO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBrZXlzLm1hcChrZXkgPT4gaXRlbVtrZXldKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBOb2RlQnVmZmVyLmFsbG9jKDEpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gc2VyaWFsaXplKFtrZXlzLCB2YWx1ZXNdKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuT2JqZWN0LCAwKTtcclxuICAgICAgICAgICAgY29udGVudExlbmd0aC53cml0ZURvdWJsZUJFKGNvbnRlbnQubGVuZ3RoLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGJ1ZmZlckl0ZW1zLnB1c2godHlwZSwgY29udGVudExlbmd0aCwgY29udGVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIGlzTm9kZUJ1ZmZlcihpdGVtKToge1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gTm9kZUJ1ZmZlci5hbGxvYygxKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGl0ZW07XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRMZW5ndGggPSBOb2RlQnVmZmVyLmFsbG9jKDgpO1xyXG5cclxuICAgICAgICAgICAgdHlwZS53cml0ZVVJbnQ4KERhdGFUeXBlLkJ1ZmZlciwgMCk7XHJcbiAgICAgICAgICAgIGNvbnRlbnRMZW5ndGgud3JpdGVEb3VibGVCRShjb250ZW50Lmxlbmd0aCwgMCk7XHJcblxyXG4gICAgICAgICAgICBidWZmZXJJdGVtcy5wdXNoKHR5cGUsIGNvbnRlbnRMZW5ndGgsIGNvbnRlbnQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBEYXRhVmlld10nOiB7XHJcbiAgICAgICAgICAgIGl0ZW0gPSBpdGVtLmJ1ZmZlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nOlxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgSW50OEFycmF5XSc6XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBJbnQxNkFycmF5XSc6XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBJbnQzMkFycmF5XSc6XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBVaW50OEFycmF5XSc6XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nOlxyXG4gICAgICAgIGNhc2UgJ1tvYmplY3QgVWludDE2QXJyYXldJzpcclxuICAgICAgICBjYXNlICdbb2JqZWN0IFVpbnQzMkFycmF5XSc6XHJcbiAgICAgICAgY2FzZSAnW29iamVjdCBGbG9hdDMyQXJyYXldJzpcclxuICAgICAgICBjYXNlICdbb2JqZWN0IEZsb2F0NjRBcnJheV0nOiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBOb2RlQnVmZmVyLmFsbG9jKDEpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdHlwZWRBcnJheVRvTm9kZUJ1ZmZlcihpdGVtKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudExlbmd0aCA9IE5vZGVCdWZmZXIuYWxsb2MoOCk7XHJcblxyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUuQnVmZmVyLCAwKTtcclxuICAgICAgICAgICAgY29udGVudExlbmd0aC53cml0ZURvdWJsZUJFKGNvbnRlbnQubGVuZ3RoLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGJ1ZmZlckl0ZW1zLnB1c2godHlwZSwgY29udGVudExlbmd0aCwgY29udGVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBOb2RlQnVmZmVyLmFsbG9jKDEpO1xyXG4gICAgICAgICAgICB0eXBlLndyaXRlVUludDgoRGF0YVR5cGUudW5rbm93LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGJ1ZmZlckl0ZW1zLnB1c2godHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gTm9kZUJ1ZmZlci5jb25jYXQoYnVmZmVySXRlbXMpO1xyXG59XHJcblxyXG4vKipcclxuICog5a+55pWw5o2u6L+b6KGM5Y+N5bqP5YiX5YyW44CCICAgXHJcbiAqIOazqOaEj++8muS8oOWFpeeahEJ1ZmZlcumcgOaYr+S9v+eUqOaYr29iamVjdDJidWZmZXLluo/liJfljJbkuqfnlJ/nmoRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZXNlcmlhbGl6ZShkYXRhOiBCdWZmZXIpOiBkYXRhVHlwZVtdIHtcclxuICAgIGxldCBwcmV2aW91cyA9IDA7XHJcblxyXG4gICAgaWYgKCFkYXRhLnNsaWNlKDAsIHByZXZpb3VzICs9IF9zZXJpYWxpemVNYXJrLmxlbmd0aCkuZXF1YWxzKF9zZXJpYWxpemVNYXJrKSlcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S8oOWFpeeahEJ1ZmZlcuW5tuS4jeaYr+eUsW9iamVjdDJidWZmZXLluo/liJfljJbkuqfnlJ/nmoTvvIzml6Dms5Xov5vooYzlj43luo/liJfljJYnKTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuXHJcbiAgICB3aGlsZSAocHJldmlvdXMgPCBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSBkYXRhLnJlYWRVSW50OChwcmV2aW91cysrKTtcclxuXHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUubnVtYmVyOiB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChkYXRhLnJlYWREb3VibGVCRShwcmV2aW91cykpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlvdXMgKz0gODtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuc3RyaW5nOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBkYXRhLnJlYWREb3VibGVCRShwcmV2aW91cyk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aW91cyArPSA4O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkYXRhLnNsaWNlKHByZXZpb3VzLCBwcmV2aW91cyArPSBsZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY29udGVudC50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuYm9vbGVhbjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGRhdGEucmVhZFVJbnQ4KHByZXZpb3VzKyspO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY29udGVudCA9PT0gMSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlLm51bGw6IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZS51bmRlZmluZWQ6IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlLkRhdGU6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBkYXRhLnJlYWREb3VibGVCRShwcmV2aW91cyk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aW91cyArPSA4O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBEYXRlKHRpbWUpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuUmVnRXhwOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VDb250ZW50TGVuZ3RoID0gZGF0YS5yZWFkRG91YmxlQkUocHJldmlvdXMpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlvdXMgKz0gODtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUNvbnRlbnQgPSBkYXRhLnNsaWNlKHByZXZpb3VzLCBwcmV2aW91cyArPSBzb3VyY2VDb250ZW50TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZsYWdzQ29udGVudExlbmd0aCA9IGRhdGEucmVhZERvdWJsZUJFKHByZXZpb3VzKTtcclxuICAgICAgICAgICAgICAgIHByZXZpb3VzICs9IDg7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmbGFnc0NvbnRlbnQgPSBkYXRhLnNsaWNlKHByZXZpb3VzLCBwcmV2aW91cyArPSBmbGFnc0NvbnRlbnRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBSZWdFeHAoc291cmNlQ29udGVudC50b1N0cmluZygpLCBmbGFnc0NvbnRlbnQudG9TdHJpbmcoKSkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZS5BcnJheToge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gZGF0YS5yZWFkRG91YmxlQkUocHJldmlvdXMpO1xyXG4gICAgICAgICAgICAgICAgcHJldmlvdXMgKz0gODtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZGF0YS5zbGljZShwcmV2aW91cywgcHJldmlvdXMgKz0gbGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGRlc2VyaWFsaXplKGNvbnRlbnQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuT2JqZWN0OiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBkYXRhLnJlYWREb3VibGVCRShwcmV2aW91cyk7XHJcbiAgICAgICAgICAgICAgICBwcmV2aW91cyArPSA4O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkYXRhLnNsaWNlKHByZXZpb3VzLCBwcmV2aW91cyArPSBsZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgW2tleXMsIHZhbHVlc10gPSBkZXNlcmlhbGl6ZShjb250ZW50KSBhcyBhbnk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqOiBhbnkgPSB7fTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtrZXlzW2ldXSA9IHZhbHVlc1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZS5CdWZmZXI6IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGRhdGEucmVhZERvdWJsZUJFKHByZXZpb3VzKTtcclxuICAgICAgICAgICAgICAgIHByZXZpb3VzICs9IDg7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZGF0YS5zbGljZShwcmV2aW91cywgcHJldmlvdXMgKz0gbGVuZ3RoKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlLnVua25vdzoge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign6KaB6KKr5Y+N5bqP5YiX5YyW55qE5pWw5o2u57G75Z6L5LiN5a2Y5Zyo77yM57G75Z6L5Li6OiAnICsgdHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufSJdfQ==
